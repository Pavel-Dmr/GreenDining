<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ecom4.green.merchant.dao.ProductDAO">

	<select id="getProduct">
		select * from product
		where id= #{id}
	</select>
	
	<select id="getProductList" parameterType="productDTO">
		select * from product
	 <where>
            <if test="data.category != null and data.category != ''">
                AND category_code LIKE '%' || #{data.category} || '%'
            </if>
            <if test="data.keyword != null and data.keyword != ''">
                AND title LIKE '%' || #{data.keyword} || '%'
            </if>
            and merchant_id = #{data.merchant_id}
        </where>
        OFFSET #{pageable.offset} ROWS FETCH NEXT #{pageable.pageSize} ROWS ONLY
	</select>
	<select id="getProductListCount" parameterType="map" resultType="int">
		select count(*) as cnt
		FROM product
        <where>
            <if test="map.category != null and map.category != ''">
                AND category_code LIKE '%' || #{map.category} || '%'
            </if>
            <if test="map.keyword != null and map.keyword != ''">
                AND title LIKE '%' || #{map.keyword} || '%'
            </if>
        </where>
	</select>

	<insert id="insertProduct" parameterType="productDTO">
		<selectKey keyProperty="id" order="BEFORE" resultType="int">
			SELECT NVL(MAX(ID),0)+1 FROM PRODUCT
		</selectKey>
			insert into product (NAME, PRICE, WEIGHT, STOCK, IMAGE_ID, STATUS, merchant_id)
			VALUES(#{name}, #{price}, #{weight}, #{stock}, #{image_id}, #{status}, #{merchant_id})
		</insert>
	<update id="updateProduct" parameterType="productDTO">
		update product set
		name = #{name},
		price = #{price},
		weight = #{weight},
		stock = #{stock},
		<if test="image_id != null">
		image_id = #{image_id},
		</if>
		status = #{status}
	</update>
	<delete id="deleteProduct" >
		delete from product
		where id = #{id}
	</delete>
</mapper>